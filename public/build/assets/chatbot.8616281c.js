document.addEventListener("DOMContentLoaded",function(){function d(e){return document.getElementById(e)}const s=d("chatbot-messages"),c=d("chatbot-input"),r=d("chatbot-send");if(!s||!c||!r){console.error("Chatbot DOM not found:",{messagesBox:s,input:c,sendBtn:r});return}function i(e,a){const t=document.createElement("div");t.className="mb-2";const n=document.createElement("span");n.className=e==="user"?"badge bg-secondary":"badge bg-success",n.textContent=e==="user"?"B\u1EA1n":"Bot";const o=document.createElement("div");o.className="mt-1",o.innerText=a,t.appendChild(n),t.appendChild(o),s.appendChild(t),s.scrollTop=s.scrollHeight}function p(e){if(!e||!Array.isArray(e)||e.length===0)return;const a=document.createElement("div");a.className="mt-3 fw-bold",a.innerText="G\u1EE3i \xFD s\u1EA3n ph\u1EA9m:",s.appendChild(a);const t=document.createElement("ul");t.className="mt-2",e.slice(0,8).forEach(n=>{var u,g,h;const o=document.createElement("li"),l=typeof n.price=="number"?n.price.toLocaleString("vi-VN"):(u=n.price)!=null?u:"";o.innerText=`${(g=n.name)!=null?g:""} \u2022 ${l}\u0111 \u2022 ${(h=n.color)!=null?h:""}`,t.appendChild(o)}),s.appendChild(t),s.scrollTop=s.scrollHeight}async function m(){var a;const e=c.value.trim();if(!!e){i("user",e),c.value="",r.disabled=!0;try{const t=window.CHATBOT_BASE_URL||"http://127.0.0.1:8001";console.log("Sending to:",`${t}/chat`,"message:",e);const n=await fetch(`${t}/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e})});if(!n.ok){const l=await n.text();i("bot",`L\u1ED7i API (${n.status}): ${l}`);return}const o=await n.json();i("bot",(a=o.answer)!=null?a:"(Kh\xF4ng c\xF3 answer)"),p(o.products)}catch(t){i("bot",`Kh\xF4ng g\u1ECDi \u0111\u01B0\u1EE3c API: ${t.message}`),console.error(t)}finally{r.disabled=!1}}}r.addEventListener("click",m),c.addEventListener("keydown",e=>{e.key==="Enter"&&m()}),console.log("Chatbot JS ready \u2705")});
